<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Repository Explorer</title>
  <link rel="stylesheet" href="assets/styles.css" />
  <style>
    /* Dashboard-specific styles */
    body { padding: 32px 20px 60px; }

    /* --- Hero --- */
    .hero {
      text-align: center;
      padding: 48px 20px 40px;
      margin-bottom: 40px;
    }
    .hero h2 {
      font-size: 48px;
      font-weight: 700;
      letter-spacing: -1px;
      margin-bottom: 14px;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-color) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero p {
      font-size: 18px;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto 28px;
      line-height: 1.6;
    }

    /* --- Section Titles --- */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      gap: 12px;
    }
    .section-title {
      font-size: 22px;
      font-weight: 600;
      letter-spacing: -0.4px;
    }
    .section-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 3px;
    }

    /* external badge on card */
    .external-tag {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 10px;
      background: rgba(255, 149, 0, 0.12);
      color: var(--warning-color);
      border: 1px solid rgba(255, 149, 0, 0.25);
      flex-shrink: 0;
    }

/* --- Generated Pages Section --- */
    #generatedSection { margin-bottom: 48px; }
    .generated-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 16px;
    }
    .generated-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      text-decoration: none;
      color: inherit;
      transition: all var(--transition);
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }
    .generated-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-color), var(--accent-hover));
    }
    .generated-card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
      border-color: var(--accent-color);
    }
    .generated-card-name {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: -0.2px;
    }
    .generated-card-meta {
      font-size: 13px;
      color: var(--text-secondary);
    }
    .generated-card-arrow {
      position: absolute;
      top: 24px; right: 24px;
      font-size: 20px;
      color: var(--text-secondary);
      transition: all var(--transition);
    }
    .generated-card:hover .generated-card-arrow {
      color: var(--accent-color);
      transform: translateX(3px);
    }

    /* --- Empty States --- */
    .empty-state {
      text-align: center;
      padding: 48px 20px;
      color: var(--text-secondary);
    }
    .empty-state .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    .empty-state p {
      font-size: 15px;
      max-width: 360px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* --- Error Banner --- */
    #errorBanner {
      margin-bottom: 20px;
      display: none;
    }

    /* --- Loading State --- */
    .repo-grid.loading {
      position: relative;
      min-height: 200px;
    }

    /* Skeleton cards */
    .skeleton-card {
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .skeleton-line {
      height: 14px;
      border-radius: 7px;
      background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-secondary) 50%, var(--bg-tertiary) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    .skeleton-line.short { width: 40%; }
    .skeleton-line.medium { width: 70%; }
    .skeleton-line.full { width: 100%; }
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Responsive */
    @media (max-width: 640px) {
      .hero h2 { font-size: 28px; }
      .hero p { font-size: 15px; }
      .username-bar { flex-wrap: wrap; }
      .selection-inner { padding: 12px 16px; }
      .hero-steps { gap: 8px; }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- ===== HEADER ===== -->
    <header class="header">
      <div class="logo" style="display:flex; align-items:center; gap:16px;">
        <img src="assets/logo-light-mode.png" alt="Cerebras" id="cerebrasLogo" style="height:28px; width:auto;" />
        <span style="font-size:20px; color:var(--text-secondary); font-weight:300;">&times;</span>
        <img id="githubLogo" src="assets/GitHub_Invertocat_Black_Clearspace.svg" alt="GitHub" style="height:28px; width:auto;" />
      </div>
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
        <svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
        <svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="display:none">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
        </svg>
      </button>
    </header>

    <!-- ===== HERO ===== -->
    <section class="hero">
      <h2>Visualize Repositories @ Lightning Fast Speed</h2>
      <p>A showcase of visual repo pages generated in real-time with Cerebras AI.</p>
      <div style="margin-top: 32px; display: flex; justify-content: center; gap: 16px; flex-wrap: wrap;">
        <a href="http://localhost:3000" class="btn btn-primary">
          <span>Launch Local Manager</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>
      </div>
    </section>

    <!-- ===== GENERATED PAGES ===== -->
    <section id="generatedSection" style="display:none">
      <div class="section-header">
        <div>
          <div class="section-title">Generated Pages</div>
          <div class="section-subtitle">Click any card to view the live visual page</div>
        </div>
        <button class="btn btn-secondary btn-sm" onclick="refreshManifest()">â†» Refresh</button>
      </div>
      <div class="generated-grid" id="generatedGrid"></div>
    </section>

    <!-- ===== HOW-THIS-WORKS ===== -->
    <section style="margin-bottom: 48px">
      <div class="section-header" style="margin-bottom: 16px; justify-content: center;">
        <div style="text-align: center;">
          <div class="section-title">How This Works</div>
          <div class="section-subtitle">Add more pages to your repos</div>
        </div>
      </div>
      <div class="card" style="padding: 32px; max-width: 640px; margin: 0 auto;">
        <div style="display: flex; flex-direction: column; gap: 20px;">
          <div style="display: flex; gap: 16px; align-items: flex-start;">
            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent-subtle); color: var(--accent-color); display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">1</div>
            <div>
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">Download Local Manager</div>
              <div style="font-size: 14px; color: var(--text-secondary);">Clone this repo and open <code style="font-family: monospace;">local-manager.html</code> locally</div>
            </div>
          </div>
          <div style="display: flex; gap: 16px; align-items: flex-start;">
            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent-subtle); color: var(--accent-color); display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">2</div>
            <div>
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">Select Repositories</div>
              <div style="font-size: 14px; color: var(--text-secondary);">Browse GitHub repos by username, choose up to 5 at a time</div>
            </div>
          </div>
          <div style="display: flex; gap: 16px; align-items: flex-start;">
            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent-subtle); color: var(--accent-color); display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">3</div>
            <div>
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">Generate Pages</div>
              <div style="font-size: 14px; color: var(--text-secondary);">Run the generate command â€“ AI creates beautiful visual pages</div>
            </div>
          </div>
          <div style="display: flex; gap: 16px; align-items: flex-start;">
            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--accent-subtle); color: var(--accent-color); display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">4</div>
            <div>
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">Deploy Automatically</div>
              <div style="font-size: 14px; color: var(--text-secondary);">Push changes and GitHub Pages updates automatically</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== FOOTER ===== -->
    <footer class="footer">
      <p>Powered by <a href="https://cloud.cerebras.ai" style="color:var(--accent-color); text-decoration:none">Cerebras AI</a></p>
    </footer>

  </div><!-- /container -->

  <script>
    // ============================================================
    // State
    // ============================================================
    let generatedSet = new Set(); // full_names that have generated pages

    // ============================================================
    // Theme
    // ============================================================
    function initTheme() {
      const saved = localStorage.getItem('theme') ||
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      applyTheme(saved);
    }
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      document.getElementById('sunIcon').style.display  = theme === 'dark' ? 'none' : 'block';
      document.getElementById('moonIcon').style.display = theme === 'dark' ? 'block' : 'none';
      updateLogos(theme);
    }
    function toggleTheme() {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'dark' ? 'light' : 'dark';
      localStorage.setItem('theme', next);
      applyTheme(next);
    }

    // ============================================================
    // Logo (optional branded image, fallback to SVG icon)
    // ============================================================
    function updateLogos(theme) {
      const cerebras = document.getElementById('cerebrasLogo');
      const github = document.getElementById('githubLogo');
      if (cerebras) cerebras.src = theme === 'dark' ? 'assets/logo-dark-mode.png' : 'assets/logo-light-mode.png';
      if (github) github.src = theme === 'dark' ? 'assets/GitHub_Invertocat_White_Clearspace.svg' : 'assets/GitHub_Invertocat_Black_Clearspace.svg';
    }

    // ============================================================
    // Manifest â€” load already-generated pages
    // ============================================================
    async function loadManifest() {
      try {
        const res = await fetch('repos/manifest.json?_=' + Date.now());
        if (!res.ok) return;
        const data = await res.json();
        renderManifest(data.generated || []);
      } catch { /* no manifest yet */ }
    }

    async function refreshManifest() {
      await loadManifest();
    }

    function renderManifest(entries) {
      generatedSet = new Set(entries.map(e => e.fullName));
      const section = document.getElementById('generatedSection');
      const grid = document.getElementById('generatedGrid');

      if (!entries.length) { section.style.display = 'none'; return; }
      section.style.display = 'block';

      const TYPE_ICONS = { ml:'ðŸ§ª', api:'ðŸŒ', cli:'ðŸ’»', frontend:'ðŸŽ¨', library:'ðŸ“¦', infra:'â˜ï¸', monorepo:'ðŸ—‚ï¸', generic:'ðŸ“„' };

      grid.innerHTML = entries.map(e => {
        const icon = TYPE_ICONS[e.type] || 'ðŸ“„';
        const date = e.generatedAt ? new Date(e.generatedAt).toLocaleDateString('en-US', { month:'short', day:'numeric' }) : '';
        const externalBadge = e.isExternal ? `<span class="external-tag">External â€” ${e.owner}</span>` : '';
        return `
          <a href="${e.url || e.path}" class="generated-card fade-in" target="_blank" rel="noopener">
            <div style="display:flex;align-items:center;gap:8px;padding-right:28px">
              <span style="font-size:20px">${icon}</span>
              <span class="generated-card-name">${e.repo}</span>
              ${externalBadge}
            </div>
            <div class="generated-card-meta">${e.owner} Â· ${e.type || 'project'}${date ? ' Â· ' + date : ''}</div>
            <span class="generated-card-arrow">â†’</span>
          </a>`;
      }).join('');
    }

    // ============================================================
    // Init
    // ============================================================
    document.addEventListener('DOMContentLoaded', async () => {
      initTheme();
      await loadManifest();
    });
  </script>
</body>
</html>
